pip@amygdala:~/build/20180325-sm-emacs-debug$ ar rvf ./mozglue/build/libmozglue.a memory/build/Unified_cpp_memory_build0.o memory/mozalloc/mozalloc_abort.o memory/mozalloc/Unified_cpp_memory_mozalloc0.o mozglue/misc/*.o mfbt/*.o

Build instructions:

# ln -sf /path/to/js/build ../js
# (cd ../js; ar rvf ./mozglue/build/libmozglue.a memory/build/Unified_cpp_memory_build0.o memory/mozalloc/mozalloc_abort.o memory/mozalloc/Unified_cpp_memory_mozalloc0.o mozglue/misc/*.o mfbt/*.o)
# sh autogen.sh
# ./configure CANNOT_DUMP=yes CC=g++ CFLAGS="-O3 -ggdb -g3 -fpermissive"
edit lib/string.h, removing this section:

  /* Search backwards through a block for a byte (specified as an int).  */
  #if 1
  # if ! 0
  _GL_FUNCDECL_SYS (memrchr, void *, (void const *, int, size_t)
                                     _GL_ATTRIBUTE_PURE
                                     _GL_ARG_NONNULL ((1)));
  # endif
    /* On some systems, this function is defined as an overloaded function:
         extern "C++" { const void * std::memrchr (const void *, int, size_t); }
         extern "C++" { void * std::memrchr (void *, int, size_t); }  */
  _GL_CXXALIAS_SYS_CAST2 (memrchr,
                          void *, (void const *, int, size_t),
                          void const *, (void const *, int, size_t));
  # if ((__GLIBC__ == 2 && __GLIBC_MINOR__ >= 10) && !defined __UCLIBC__) \
       && (__GNUC__ > 4 || (__GNUC__ == 4 && __GNUC_MINOR__ >= 4))
  _GL_CXXALIASWARN1 (memrchr, void *, (void *, int, size_t));
  _GL_CXXALIASWARN1 (memrchr, void const *, (void const *, int, size_t));
  # else
  _GL_CXXALIASWARN (memrchr);
  # endif
  #elif defined GNULIB_POSIXCHECK
  # undef memrchr
  # if HAVE_RAW_DECL_MEMRCHR
  _GL_WARN_ON_USE (memrchr, "memrchr is unportable - "
                   "use gnulib module memrchr for portability");
  # endif
  #endif

# mkdir src/chunkl-cache lwlib/chunkl-cache lib/chunkl-cache
# touch lwlib/chunkl.all lib/chunkl.all
# make -C lwlib lwlib-widget.h.hh
# make -C lib minmax.h.hh diffseq.h.hh md5.h.hh sha1.h.hh sha256.h.hh sha512.h.hh u64.h.hh
# make

  this will take much, much longer than usual, and produce many
  warning messages.  It might ultimately fail, but will have built
  temacs by that point, hopefully.

# export LD_LIBRARY_PATH=.../js/dist/bin/:$LD_LIBRARY_PATH
# gdb --args ./src/temacs -Q

  this will also take much longer than usual, but eventually an X
  frame should appear.
